"use strict";Vue.component("pop",{template:"#pop",data:function(){return{positionY:0,timer:null}},props:["msg"],methods:{close:function(){this.$emit("close")}}});var app=new Vue({computed:{addressStr:function(){return this.address.province+this.address.cityId+this.address.townId+this.address.address}},mounted:function(){var o=this;o.loadAddress(),o.loadCarts(),o.coupon=config.coupon,o.loadCoupon(),o.calTotal(),o.calculateAmount(0)},data:{showAlert:!1,msg:null,show_coup:!1,coupPri:null,carts:[],address:{},hasAddress:!1,remark:"",has_terms:config.has_terms,couponcode:"",hasCoupon:!1,coupon:{},couponAmount:0,totalPrice:0,points:config.points,usedPoint:0,usePoint:!1,accountAmount:config.accountAmount,usedAccountAmount:0,useAccountAmount:!1},watch:{},methods:{showCoup:function(){var o=this;o.show_coup=!o.show_coup},loadAddress:function(){var o=this;o.address=config.address,void 0!==o.address.id?o.hasAddress=!0:o.hasAddress=!1},loadCarts:function(){this.carts=config.carts},loadCoupon:function(){var o=this;o.coupon&&o.coupon.couponCode?(o.hasCoupon=!0,o.couponAmount=o.coupon.couponAmount):o.hasCoupon=!1},getCoupon:function(){var o=this;jAjax({type:"post",url:config.coupon_url,data:{validateCoupon:config.validateCoupon,couponCode:o.couponcode},timeOut:5e3,before:function(){console.log("before")},success:function(t){t&&(t=JSON.parse(t),200==parseInt(t.code)?(o.showCoup(),o.coupon.couponAmount=t.data,o.coupon.couponCode=o.couponcode,o.loadCoupon(),o.calculateAmount(0)):(o.msg=t.message,o.showAlert=!0,o.close_auto()))},error:function(){console.log("error")}})},calTotal:function(){var o=this,t=0;o.carts.forEach(function(o){t+=parseFloat(o.promotionPrice)*parseFloat(o.buyCount)}),o.totalPrice=t.toFixed(2)},close:function(){this.showAlert=!1},close_auto:function(o,t){var n=this;setTimeout(function(){n.showAlert=!1,o&&o(t)},1500)},linkto:function(o){o&&(location.href=o)},pay:function(){var o=this,t=[],n="";o.carts.forEach(function(o){var n={};n.goodsId=o.goodsId,n.specId=o.goodsSpecId,n.buyCount=o.buyCount,t.push(n)}),o.coupon&&o.coupon.couponCode&&(n=o.coupon.couponCode),o.has_terms?jAjax({type:"post",url:config.pay_url,data:{points:o.usedPoint,accountAmount:o.usedAccountAmount,couponCode:n,remark:o.remark,addressId:o.address.id,orderGoodsInfo:base64.encode64(JSON.stringify(t)),has_terms:o.has_terms},timeOut:5e3,before:function(){console.log("before")},success:function(t){t&&(t=JSON.parse(t),200==parseInt(t.code)?(o.msg=t.message,o.showAlert=!0,o.close_auto(o.linkto,t.url)):(o.msg=t.message,o.showAlert=!0,o.close_auto()))},error:function(o,t){console.log(t)}}):(o.msg="请同意并钩选《方寸堂服务协议》",o.showAlert=!0,o.close_auto())},calculateAmount:function(o){var t=this;t.calTotal(),t.totalPrice=t.totalPrice-t.couponAmount,t.points=config.points,t.accountAmount=config.accountAmount,1==o?t.usePoint=!t.usePoint:2==o&&(t.useAccountAmount=!t.useAccountAmount),t.usedPoint=0,t.usedAccountAmount=0,t.points>0&&t.usePoint&&(t.points/100>t.totalPrice?(t.usedPoint=100*t.totalPrice,t.totalPrice=0):(t.totalPrice=t.totalPrice-t.points/100,t.usedPoint=t.points)),t.totalPrice>0&&t.accountAmount>0&&t.useAccountAmount&&(t.accountAmount>t.totalPrice?(t.usedAccountAmount=t.totalPrice,t.totalPrice=0):(t.totalPrice=t.totalPrice-t.accountAmount,t.usedAccountAmount=t.accountAmount))}}}).$mount("#buy");
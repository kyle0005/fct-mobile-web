"use strict";var app=new Vue({mounted:function(){var t=this;""!==t.imgObj.backgroundUrl&&null!==t.imgObj.backgroundUrl&&void 0!==t.imgObj.backgroundUrl?(t.showBtn=!1,t.drawTop()):t.drawCanvas()},data:{showAlert:!1,msg:config.msg,showBtn:!0,imgObj:config.imgObj,ratio:0},methods:{drawTop:function(){var t=this;t.ratio=window.devicePixelRatio||1;var i=window.innerWidth||document.documentElement.clientWidth,o=window.innerHeight||document.documentElement.clientHeight,e=null;e=document.createElement("canvas");var a=document.getElementById("con_result");e.width=i*t.ratio,e.height=o*t.ratio;var r=e.getContext("2d");r.mozImageSmoothingEnabled=!1,r.webkitImageSmoothingEnabled=!1,r.msImageSmoothingEnabled=!1,r.imageSmoothingEnabled=!1,r.fillStyle="#ffffff",r.fillRect(0,0,i*t.ratio,o*t.ratio);var n=0,l=new Image;l.setAttribute("crossOrigin","anonymous"),l.src=t.imgObj.backgroundUrl,l.onload=function(){if(r.drawImage(l,0,0,i*t.ratio,l.height/l.width*i*t.ratio),2===(n+=1)){var m=Canvas2Image.convertToImage(e,i*t.ratio,o*t.ratio);m.style.width="100%",a.appendChild(m)}var g=new Image;g.setAttribute("crossOrigin","anonymous"),g.src=t.imgObj.qrcodeUrl,g.onload=function(){if(r.drawImage(g,(i-350/1242*i)/2*t.ratio,1165/1242*i*t.ratio,350/1242*i*t.ratio,350/1242*i*t.ratio),2===(n+=1)){var l=Canvas2Image.convertToImage(e,i*t.ratio,o*t.ratio);l.style.width="100%",a.appendChild(l)}}}},drawCanvas:function(){var t=this;t.ratio=window.devicePixelRatio||1;var i=window.innerWidth||document.documentElement.clientWidth,o=(window.innerHeight||document.documentElement.clientHeight,null);o=document.createElement("canvas");var e=document.getElementById("btn"),a=document.getElementById("con_result");o.width=i*t.ratio*2,o.height=970/750*i*t.ratio*2,o.style.width=i+"px",o.style.height=970/750*i+"px";var r=o.getContext("2d");r.mozImageSmoothingEnabled=!1,r.webkitImageSmoothingEnabled=!1,r.msImageSmoothingEnabled=!1,r.imageSmoothingEnabled=!1,r.fillStyle="#ffffff",r.fillRect(0,0,i*t.ratio*2,970/750*i*t.ratio*2);var n=.04*i*t.ratio*2;r.fillStyle="#333",r.font=16*t.ratio*2+"px 微软雅黑",r.fillText(t.imgObj.artistName+"《"+t.imgObj.name+"》",n,(i+70/750*i)*t.ratio*2),r.fillStyle="#d8d8d8",r.fillRect(n,(i+100/750*i)*t.ratio*2,.16*i*t.ratio*2,.064*i*t.ratio*2),r.fillStyle="#666",r.font=15*t.ratio*2+"px 微软雅黑",r.textAlign="center",r.fillText(t.imgObj.volumes[0]+"CC",n+.08*i*t.ratio*2,(i+136/750*i)*t.ratio*2),t.imgObj.volumes[1]&&(r.fillStyle="#d8d8d8",r.fillRect(.04*i*t.ratio*2+2*n+.16*i*t.ratio*2,(i+100/750*i)*t.ratio*2,.16*i*t.ratio*2,.064*i*t.ratio*2),r.fillStyle="#666",r.font=15*t.ratio*2+"px 微软雅黑",r.fillText("─",n+.16*i*t.ratio*2+.04*i*t.ratio*2,(i+136/750*i)*t.ratio*2),r.textAlign="center",r.fillText(t.imgObj.volumes[1]+"CC",.04*i*t.ratio*2+2*n+.16*i*t.ratio*2+.08*i*t.ratio*2,(i+136/750*i)*t.ratio*2));var l=new Image;l.setAttribute("crossOrigin","anonymous"),l.src=config.tipsImg,l.onload=function(){if(r.drawImage(l,n,(i+175/750*i)*t.ratio*2,.036*i*t.ratio*2,.036*i*t.ratio*2),r.drawImage(l,n+.2*i*t.ratio*2,(i+175/750*i)*t.ratio*2,.036*i*t.ratio*2,.036*i*t.ratio*2),r.drawImage(l,n+.4*i*t.ratio*2,(i+175/750*i)*t.ratio*2,.036*i*t.ratio*2,.036*i*t.ratio*2),4===(m+=1)){var g=Canvas2Image.convertToImage(o,i*t.ratio,970/750*i*t.ratio);g.style.width="100%",a.insertBefore(g,e)}},r.fillStyle="#999",r.font=12*t.ratio*2+"px 微软雅黑",r.textAlign="left",r.fillText(config.tips[0],n+35/750*i*t.ratio*2,(i+196/750*i)*t.ratio*2),r.fillText(config.tips[1],n+185/750*i*t.ratio*2,(i+196/750*i)*t.ratio*2),r.fillText(config.tips[2],n+335/750*i*t.ratio*2,(i+196/750*i)*t.ratio*2);var m=0,g=new Image;g.setAttribute("crossOrigin","anonymous"),g.src=t.imgObj.defaultImage,g.onload=function(){if(r.drawImage(g,0,0,i*t.ratio*2,g.height/g.width*i*t.ratio*2),4===(m+=1)){var n=Canvas2Image.convertToImage(o,i*t.ratio,970/750*i*t.ratio);n.style.width="100%",a.insertBefore(n,e)}var l=new Image;l.setAttribute("crossOrigin","anonymous"),l.src=t.imgObj.qrcodeUrl,l.onload=function(){if(r.drawImage(l,530/750*i*t.ratio*2,g.height/g.width*i*t.ratio*2,220/750*i*t.ratio*2,220/750*i*t.ratio*2),4===(m+=1)){var n=Canvas2Image.convertToImage(o,i*t.ratio,970/750*i*t.ratio);n.style.width="100%",a.insertBefore(n,e)}};var c=new Image;c.setAttribute("crossOrigin","anonymous"),c.src=t.imgObj.headPortrait,c.onload=function(){if(t.circleImg(r,c,32/750*i,32/750*i,100/750*i/2),4===(m+=1)){var n=Canvas2Image.convertToImage(o,i*t.ratio,970/750*i*t.ratio);n.style.width="100%",a.insertBefore(n,e)}}}},preImage:function(t,i,o){var e=new Image;if(e.src=t,e.complete)return void i.call(e,o);e.onload=function(){i.call(e,o)},e.onerror=function(){var e=+new Date;vue.preImage(t+"?"+e,i,o)}},circleImg:function(t,i,o,e,a){var r=this;t.save();var n=2*a,l=(o+a)*r.ratio*2,m=(e+a)*r.ratio*2;t.beginPath(),t.lineWidth=3*r.ratio*2,t.strokeStyle="#fff",t.arc(l,m,a*r.ratio*2,0,2*Math.PI),t.stroke(),t.closePath(),t.clip(),t.drawImage(i,o*r.ratio*2,e*r.ratio*2,n*r.ratio*2,n*r.ratio*2),t.restore()},pop:function(){var t=this;t.showAlert=!0,t.close_auto()},close:function(){this.showAlert=!1},close_auto:function(t,i){var o=this;setTimeout(function(){o.showAlert=!1,t&&t(i)},1500)},linkto:function(t){t&&(location.href=t)}}}).$mount("#screenshot");
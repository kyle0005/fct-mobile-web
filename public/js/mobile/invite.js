"use strict";var app=new Vue({mounted:function(){this.drawPic()},data:{username:config.user.userName,headportrait:config.user.headPortrait,qrcodeurl:config.qrcodeUrl,backgroundurl:config.backgroundUrl,logourl:config.logoUrl,textobj:config.textObj,ratio:0,showAlert:!1,msg:config.msg},methods:{drawPic:function(){var t=this;t.ratio=window.devicePixelRatio||1;var o=window.innerWidth||document.documentElement.clientWidth,e=window.innerHeight||document.documentElement.clientHeight,i=null;i=document.createElement("canvas");var r=document.getElementById("con_result");i.width=o*t.ratio,i.height=e*t.ratio;var n=i.getContext("2d");n.mozImageSmoothingEnabled=!1,n.webkitImageSmoothingEnabled=!1,n.msImageSmoothingEnabled=!1,n.imageSmoothingEnabled=!1,n.fillStyle="#edece6",n.fillRect(0,0,o*t.ratio,e*t.ratio);var a=0,l=new Image;l.setAttribute("crossOrigin","anonymous"),l.src=t.backgroundurl,l.onload=function(){o=l.width,e=l.height,i.width=o*t.ratio,i.height=e*t.ratio,n.drawImage(l,0,0,o*t.ratio,l.height/l.width*o*t.ratio),a+=1,4===a&&(t.convertToImg(i,r,o,e),l=null),n.fillStyle="#993333",n.font=12*t.ratio*2+"px 微软雅黑",t.canvasTextAutoLine(t.username+t.textobj.textInfo,n,.256*o*t.ratio,.744*o*t.ratio,22*t.ratio*2,550/750*o*t.ratio),n.fillStyle="#666666",n.font=13*t.ratio*2+"px 微软雅黑",n.textAlign="center",n.fillText(t.textobj.textQrcode,.5*o*t.ratio,1060/750*o*t.ratio),n.fillStyle="#20201f",n.font=48*t.ratio*2+"px 微软雅黑",n.fillText(t.textobj.textM,65/750*o*t.ratio,1259/750*o*t.ratio),n.fillStyle="#20201f",n.font=48*t.ratio*2+"px 微软雅黑",n.fillText(t.textobj.textM,65/750*o*t.ratio,1.736*o*t.ratio),n.fillStyle="#20201f",n.textAlign="left",n.font="bold "+17*t.ratio*2+"px 微软雅黑",n.fillText(t.textobj.textTip,55/750*o*t.ratio,1.56*o*t.ratio),n.fillStyle="#20201f",n.font=12*t.ratio*2+"px 微软雅黑",n.fillText(t.textobj.textLine1,.12*o*t.ratio,1234/750*o*t.ratio),n.fillStyle="#20201f",n.font=12*t.ratio*2+"px 微软雅黑",n.fillText(t.textobj.textLine2,.12*o*t.ratio,1277/750*o*t.ratio);var c=new Image;c.setAttribute("crossOrigin","anonymous"),c.src=t.headportrait,c.onload=function(){t.circleImg(n,c,.404*o,334/750*o,70/750*o),4===(a+=1)&&t.convertToImg(i,r,o,e)};var u=new Image;u.setAttribute("crossOrigin","anonymous"),u.src=t.qrcodeurl,u.onload=function(){n.drawImage(u,.304*o*t.ratio,737/750*o*t.ratio,.392*o*t.ratio,.392*o*t.ratio),4===(a+=1)&&(t.convertToImg(i,r,o,e),u=null)};var s=new Image;s.setAttribute("crossOrigin","anonymous"),s.src=t.logourl,s.onload=function(){n.drawImage(s,646/750*o*t.ratio,1222/750*o*t.ratio,52/750*o*t.ratio,52/750*o*t.ratio),4===(a+=1)&&(t.convertToImg(i,r,o,e),s=null)}}},convertToImg:function(t,o,e,i){var r=this,n=document.getElementById("btn"),a=Canvas2Image.convertToImage(t,e*r.ratio,i*r.ratio);a.style.width="100%",o.insertBefore(a,n),t=null},preImage:function(t,o,e){var i=new Image;if(i.src=t,i.complete)return void o.call(i,e);i.onload=function(){o.call(i,e)},i.onerror=function(){var i=+new Date;vue.preImage(t+"?"+i,o,e)}},circleImg:function(t,o,e,i,r){var n=this;t.save();var a=2*r,l=(e+r)*n.ratio,c=(i+r)*n.ratio;t.beginPath(),t.lineWidth=6*n.ratio*2,t.strokeStyle="#fff",t.arc(l,c,r*n.ratio,0,2*Math.PI),t.stroke(),t.closePath(),t.clip(),t.drawImage(o,e*n.ratio,i*n.ratio,a*n.ratio,a*n.ratio),t.restore()},canvasTextAutoLine:function(t,o,e,i,r,n){for(var a=0,l=n,c=0,u=0;u<t.length;u++)a+=o.measureText(t[u]).width,a>l-e&&(o.fillText(t.substring(c,u),e,i),i+=r,a=0,c=u),u==t.length-1&&o.fillText(t.substring(c,u+1),e,i)},pop:function(){var t=this;t.showAlert=!0,t.close_auto()},close:function(){this.showAlert=!1},close_auto:function(t,o){var e=this;setTimeout(function(){e.showAlert=!1,t&&t(o)},1500)},linkto:function(t){t&&(location.href=t)}}}).$mount("#invite");
"use strict";var app=new Vue({mounted:function(){this.drawPic()},data:{username:config.user.userName,headportrait:config.user.headPortrait,qrcodeurl:config.qrcodeUrl,backgroundurl:config.backgroundUrl,logourl:config.logoUrl,textobj:config.textObj,ratio:0},methods:{drawPic:function(){var t=this;t.ratio=window.devicePixelRatio||1;var o=window.innerWidth||document.documentElement.clientWidth,e=window.innerHeight||document.documentElement.clientHeight,i=null;i=document.createElement("canvas");var r=document.getElementById("con_result");i.width=o*t.ratio,i.height=e*t.ratio;var a=i.getContext("2d");a.mozImageSmoothingEnabled=!1,a.webkitImageSmoothingEnabled=!1,a.msImageSmoothingEnabled=!1,a.imageSmoothingEnabled=!1,a.fillStyle="#edece6",a.fillRect(0,0,o*t.ratio,e*t.ratio);var n=0,l=new Image;l.setAttribute("crossOrigin","anonymous"),l.src=t.backgroundurl,l.onload=function(){o=l.width,e=l.height,i.width=o*t.ratio,i.height=e*t.ratio,a.drawImage(l,0,0,o*t.ratio,l.height/l.width*o*t.ratio),n+=1,4===n&&t.convertToImg(i,r,o,e),a.fillStyle="#993333",a.font=12*t.ratio*2+"px 微软雅黑",t.canvasTextAutoLine(t.username+t.textobj.textInfo,a,.256*o*t.ratio,.744*o*t.ratio,22*t.ratio*2,550/750*o*t.ratio),a.fillStyle="#666666",a.font=13*t.ratio*2+"px 微软雅黑",a.textAlign="center",a.fillText(t.textobj.textQrcode,.5*o*t.ratio,1060/750*o*t.ratio),a.fillStyle="#20201f",a.font=48*t.ratio*2+"px 微软雅黑",a.fillText(t.textobj.textM,65/750*o*t.ratio,1259/750*o*t.ratio),a.fillStyle="#20201f",a.font=48*t.ratio*2+"px 微软雅黑",a.fillText(t.textobj.textM,65/750*o*t.ratio,1.736*o*t.ratio),a.fillStyle="#20201f",a.textAlign="left",a.font="bold "+17*t.ratio*2+"px 微软雅黑",a.fillText(t.textobj.textTip,55/750*o*t.ratio,1.56*o*t.ratio),a.fillStyle="#20201f",a.font=12*t.ratio*2+"px 微软雅黑",a.fillText(t.textobj.textLine1,.12*o*t.ratio,1234/750*o*t.ratio),a.fillStyle="#20201f",a.font=12*t.ratio*2+"px 微软雅黑",a.fillText(t.textobj.textLine2,.12*o*t.ratio,1277/750*o*t.ratio);var c=new Image;c.setAttribute("crossOrigin","anonymous"),c.src=t.headportrait,c.onload=function(){t.circleImg(a,c,.404*o,334/750*o,70/750*o),4===(n+=1)&&t.convertToImg(i,r,o,e)};var g=new Image;g.setAttribute("crossOrigin","anonymous"),g.src=t.qrcodeurl,g.onload=function(){a.drawImage(g,.304*o*t.ratio,737/750*o*t.ratio,.392*o*t.ratio,.392*o*t.ratio),4===(n+=1)&&t.convertToImg(i,r,o,e)};var d=new Image;d.setAttribute("crossOrigin","anonymous"),d.src=t.logourl,d.onload=function(){a.drawImage(d,646/750*o*t.ratio,1222/750*o*t.ratio,52/750*o*t.ratio,52/750*o*t.ratio),4===(n+=1)&&t.convertToImg(i,r,o,e)}}},convertToImg:function(t,o,e,i){var r=this,a=Canvas2Image.convertToImage(t,e*r.ratio,i*r.ratio);a.style.width="100%",o.appendChild(a)},preImage:function(t,o,e){var i=new Image;if(i.src=t,i.complete)return void o.call(i,e);i.onload=function(){o.call(i,e)},i.onerror=function(){var i=+new Date;vue.preImage(t+"?"+i,o,e)}},circleImg:function(t,o,e,i,r){var a=this;t.save();var n=2*r,l=(e+r)*a.ratio,c=(i+r)*a.ratio;t.beginPath(),t.lineWidth=6*a.ratio*2,t.strokeStyle="#fff",t.arc(l,c,r*a.ratio,0,2*Math.PI),t.stroke(),t.closePath(),t.clip(),t.drawImage(o,e*a.ratio,i*a.ratio,n*a.ratio,n*a.ratio),t.restore()},canvasTextAutoLine:function(t,o,e,i,r,a){for(var n=0,l=a,c=0,g=0;g<t.length;g++)n+=o.measureText(t[g]).width,n>l-e&&(o.fillText(t.substring(c,g),e,i),i+=r,n=0,c=g),g==t.length-1&&o.fillText(t.substring(c,g+1),e,i)}}}).$mount("#invite");
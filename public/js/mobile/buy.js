"use strict";var app=new Vue({computed:{addressStr:function(){return this.address.province+this.address.cityId+this.address.townId+this.address.address}},mounted:function(){var o=this;o.loadAddress(),o.loadCarts(),o.coupon=config.coupon,o.loadCoupon(),o.calTotal(),o.calculateAmount(0)},data:{showAlert:!1,msg:null,show_coup:!1,coupPri:null,carts:[],address:{},hasAddress:!1,remark:"",has_terms:config.has_terms,couponcode:"",hasCoupon:!1,coupon:{},couponAmount:0,totalPrice:0,points:config.points,usedPoint:0,usePoint:!1,accountAmount:config.accountAmount,usedAccountAmount:0,useAccountAmount:!1},watch:{},methods:{showCoup:function(){var o=this;o.show_coup=!o.show_coup},loadAddress:function(){var o=this;o.address=config.address,o.address&&o.address.id>0?o.hasAddress=!0:o.hasAddress=!1},loadCarts:function(){this.carts=config.carts},loadCoupon:function(){var o=this;o.coupon&&o.coupon.couponCode?(o.hasCoupon=!0,o.couponAmount=o.coupon.couponAmount):o.hasCoupon=!1},getCoupon:function(){var o=this,t=config.coupon_url,n={validateCoupon:config.validateCoupon,couponCode:o.couponcode};o.$refs.usecoup.post(t,n)},calTotal:function(){var o=this,t=0;o.carts.forEach(function(o){t+=parseFloat(o.promotionPrice)*parseFloat(o.buyCount)}),o.totalPrice=t.toFixed(2)},pay:function(){var o=this,t=[],n="",u=config.pay_url,s={};o.carts.forEach(function(o){var n={};n.goodsId=o.goodsId,n.specId=o.goodsSpecId,n.buyCount=o.buyCount,t.push(n)}),o.coupon&&o.coupon.couponCode&&(n=o.coupon.couponCode),o.has_terms?(s={points:o.usedPoint,accountAmount:o.usedAccountAmount,couponCode:n,remark:o.remark,addressId:o.address?o.address.id:0,orderGoodsInfo:JSON.stringify(t),has_terms:o.has_terms},o.$refs.paypost.post(u,s)):(o.msg="请同意并钩选《方寸堂服务协议》",o.showAlert=!0,o.close_auto())},calculateAmount:function(o){var t=this;t.calTotal(),t.totalPrice=t.totalPrice-t.couponAmount,t.points=config.points,t.accountAmount=config.accountAmount,1==o?t.usePoint=!t.usePoint:2==o&&(t.useAccountAmount=!t.useAccountAmount),t.usedPoint=0,t.usedAccountAmount=0,t.points>0&&t.usePoint&&(t.points/100>t.totalPrice?(t.usedPoint=100*t.totalPrice,t.totalPrice=0):(t.totalPrice=t.totalPrice-t.points/100,t.usedPoint=t.points)),t.totalPrice>0&&t.accountAmount>0&&t.useAccountAmount&&(t.accountAmount>t.totalPrice?(t.usedAccountAmount=t.totalPrice,t.totalPrice=0):(t.totalPrice=t.totalPrice-t.accountAmount,t.usedAccountAmount=t.accountAmount))},toFloat:function(o){return o.toFixed(2)},payhandle:function(o){var t=this;t.msg=o.message,t.showAlert=!0,o.url?t.close_auto(t.linkto,o.url):t.close_auto()},succhandle:function(o){var t=this;t.showCoup(),t.coupon.couponAmount=o.data,t.coupon.couponCode=t.couponcode,t.loadCoupon(),t.calculateAmount(0)},postSuc:function(o){},postTip:function(o){var t=this;t.msg=o.message,t.showAlert=!0,t.close_auto()},postBefore:function(){},postError:function(){},close:function(){this.showAlert=!1},close_auto:function(o,t){var n=this;setTimeout(function(){n.showAlert=!1,o&&o(t)},1500)},linkto:function(o){o&&(location.href=o)}}}).$mount("#buy");
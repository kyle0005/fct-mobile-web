"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,o=Array(t.length);e<t.length;e++)o[e]=t[e];return o}return Array.from(t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Vue.component("mVideo",{template:"#m_video",data:function(){return{isVideoLoad:!1}},mounted:function(){},props:{poster:{type:String,default:""},url:{type:String,default:""},id:{type:String,default:""}},methods:{loadVideo:function(){var t=this;t.isVideoLoad=!0,t.$nextTick(function(){var e=document.getElementById(t.id);e.play(),e.addEventListener("ended",function(){t.isVideoLoad=!1})})}}}),Vue.component("m-swipe",{template:"#m_swipe",props:{swipeid:{type:String,default:""},effect:{type:String,default:"slide"},loop:{type:Boolean,default:!1},direction:{type:String,default:"horizontal"},pagination:{type:Boolean,default:!0},autoplay:{type:Number,default:5e3},paginationType:{type:String,default:"bullets"}},data:function(){return{dom:""}},mounted:function(){var t=this;this.dom=new Swiper("."+t.swipeid,{loop:t.loop,pagination:".swiper-pagination",paginationType:t.paginationType,autoplay:t.autoplay,direction:t.direction,effect:t.effect,autoplayDisableOnInteraction:!1,observer:!0,observeParents:!0,height:window.innerHeight,lazyLoading:!0,onTransitionStart:function(e){t.$emit("slideindex",e.activeIndex)}})},components:{}});var _time_html='<span :endTime="endTime" :callback="callback" ><slot><span class="time-block">{{ time_content.hour }}</span>小时<span class="time-block">{{ time_content.min }}</span>分<span class="time-block">{{ time_content.sec }}</span>秒</slot></span>';Vue.component("m-time",{template:_time_html,data:function(){return{product:config.product,time_content:{day:"00",hour:"00",min:"00",sec:"00"},_sec:0}},props:{endTime:{type:Number,default:0},callback:{type:Function,default:""}},mounted:function(){this.initTime(),this.countdowm(this._sec)},methods:{initTime:function(){var t=this,e=t.product,o=0;1===e.status?o=parseInt((e.startTime-e.nowTime)/1e3):4!==e.status&&(o=parseInt((e.endTime-e.nowTime)/1e3)),t._sec=o},_countdown:function(t,e,o){var n={d:0,df:0,h:0,hf:0,m:0,s:0},i={h:0,m:0,s:0},a=setInterval(function(){e>0?(n.d=Math.floor(e/86400),n.df=e%86400,n.h=Math.floor(n.df/3600),n.hf=n.df%3600,n.m=Math.floor(n.hf/60),n.s=e%60,i.h=n.h.toString().length>1?n.h:"0"+n.h,i.m=n.m.toString().length>1?n.m:"0"+n.m,i.s=n.s.toString().length>1?n.s:"0"+n.s,e-=1,o(t,i)):clearInterval(a)},1e3)},countdowm:function(t){var e=this,o=(new Date).getTime(),n=setInterval(function(){var i=new Date,a=new Date(1e3*t+o),r=a.getTime()-i.getTime();if(r>0){var s=Math.floor(r/864e5),c=Math.floor(r/36e5%24),u=Math.floor(r/6e4%60),d=Math.floor(r/1e3%60);c+=24*s,c=c<10?"0"+c:c,u=u<10?"0"+u:u,d=d<10?"0"+d:d,s>0&&(e.time_content.hour=c,e.time_content.min=u,e.time_content.sec=d),s<=0&&c>0&&(e.time_content.hour=c,e.time_content.min=u,e.time_content.sec=d),s<=0&&c<=0&&(e.time_content.min=u,e.time_content.sec=d)}else clearInterval(n),e._callback()},1e3)},_callback:function(){this.callback&&this.callback instanceof Function&&this.callback.apply(this,_toConsumableArray(this))}}});var app=new Vue({data:{product:config.product,chat_list:config.chatList,ranks_list:[],pro_list:[],loading:!1,refreshing:!1,currentPrice:config.product.bidPrice,showAlert:!1,msg:null,open:!1,docked:!1,chosen:!1,swiper:"",tops:config.product.images,onId:0,addpri:0,wsurl:config.ws_auction_url+"?token="+config.product.token+"&relation_id="+config.product.id,ws:{},wsMsg:"",reload:!0},watch:{chat_list:function(t,e){this.$nextTick(function(){var t=this.$el.querySelector("#chatContainer");console.log(t),t.scrollTop=t.scrollHeight})}},mounted:function(){var t=this,e=this.$refs.swiper;e.dom&&(this.swiper=e.dom);var o=document.querySelector("#chatContainer"),n=new Hammer(o);n.on("swipeleft",function(t){console.log("swipeleft")}),n.on("swiperight",function(e){t.choose()}),t.choose(),t.product.status&&1===parseInt(t.product.status)&&t.choose(),t.init_ws()},methods:{top:function(){tools.animate(document,{scrollTop:"0"},400,"ease-out")},choose:function(){var t=this;t.open?(t.open=!1,setTimeout(function(){t.docked=!1},300)):(t.docked=!0,t.open=!0)},add:function(){var t=this,e=t.product,o=parseFloat(t.addpri),n=parseFloat(t.currentPrice);3===e.status&&(o<n?o=n+e.increasePrice:o+=e.increasePrice,t.addpri=o)},end:function(){console.log("end"),tools.ajaxGet(config.reload_url,this.reloadData_suc,this.reloadData_bef)},reloadData_bef:function(){},reloadData_suc:function(t){var e=this;e.product=t.data,e.init_ws(),e.reload=!1,e.reload=!0},succhandle:function(t){var e=this;e.msg=t.message,e.showAlert=!0,t.url?e.close_auto(e.linkto,t.url):e.close_auto()},close:function(){this.showAlert=!1},close_auto:function(t,e){var o=this;setTimeout(function(){o.showAlert=!1,t&&t(e)},1500)},linkto:function(t){t&&(location.href=t)},init_ws:function(){var t=this;t.isEmpty(t.product);if(4!==t.product.status){var e=new WebSocket(t.wsurl);e.addEventListener("open",function(t){}),e.addEventListener("message",function(e){t.listenSocket(e)}),t.ws=e}t.setBidOn(t.chat_list);var o=t.$el.querySelector("#chatContainer");console.log(o),o.scrollTop=o.scrollHeight},listenSocket:function(t){var e=this;if(!e.isEmpty(t.data)){var o=JSON.parse(t.data);if(200!==o.code)return e.msg=o.msg,e.showAlert=!0,void e.close_auto();1===o.data.roleType&&(o.data.bidStatus=1);var n=e.chat_list;n.push(o.data);var i=e.product;if(i.bidCount=i.bidCount+1,e.chat_list=[],e.chat_list=n,e.product={},e.product=i,1===o.data.roleType){var a=e.product;e.product={},a.product.bidUserHeadPortrait=o.data.headPortrait,a.product.bidUserName=o.data.userName,a.product.bidStatusName=o.data.bidStatusName?o.data.bidStatusName:"领先",a.product.bidPrice=o.data.bidPrice,e.currentPrice=o.data.bidPrice,e.product=a,e.setBidOn(e.chat_list)}}},setBidOn:function(t){var e=this,o=e.onId;if(o>0)o=t[t.length-1].id;else for(var n in t)if(t[n].bidStatus>0){o=t[n].id;break}e.onId=o},isEmpty:function(t){if(null===t||""===t||void 0===t||!1===t)return!0;if("object"==(void 0===t?"undefined":_typeof(t))){for(var e in t)return!1;return!0}return!1},bindDepositTap:function(){var t=this,e=this.product,o={goods_id:e.id};2===e.status?jAjax({type:"post",url:config.auction_signup_url,data:o,timeOut:5e3,before:function(){console.log("before")},success:function(e){e&&(e=JSON.parse(e),200===parseInt(e.code)?t.succhandle(e):console.log("false"))},error:function(t,e){console.log(e)}}):1===e.status?(t.msg="拍卖还未开始",t.showAlert=!0,t.close_auto()):4!==e.status?(t.msg="您已报过名了",t.showAlert=!0,t.close_auto()):4===e.status&&(t.msg="拍卖已经结束了",t.showAlert=!0,t.close_auto())},bindSubmitTap:function(){var t=this;jAjax({type:"post",url:config.auction_bid_url,data:{goods_id:t.product.id,price:t.addpri},timeOut:5e3,before:function(){console.log("before")},success:function(t){t&&(t=JSON.parse(t),200===parseInt(t.code)||console.log("false"))},error:function(t,e){console.log(e)}})},bindSendTap:function(){var t=this;t.product.token&&""!==t.product.token&&null!==t.product.token&&(t.ws.send(t.wsMsg),t.wsMsg="")},clear:function(){this.addpri=0}},components:{}}).$mount("#auctiondetail");
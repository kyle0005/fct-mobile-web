"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Vue.component("mVideo",{template:"#m_video",data:function(){return{isVideoLoad:!1}},mounted:function(){},props:{poster:{type:String,default:""},url:{type:String,default:""},id:{type:String,default:""}},methods:{loadVideo:function(){var t=this;t.isVideoLoad=!0,t.$nextTick(function(){var o=document.getElementById(t.id);o.play(),o.addEventListener("ended",function(){t.isVideoLoad=!1})})}}}),Vue.component("m-swipe",{template:"#m_swipe",props:{swipeid:{type:String,default:""},effect:{type:String,default:"slide"},loop:{type:Boolean,default:!1},direction:{type:String,default:"horizontal"},pagination:{type:Boolean,default:!0},autoplay:{type:Number,default:5e3},paginationType:{type:String,default:"bullets"}},data:function(){return{dom:""}},mounted:function(){var t=this;this.dom=new Swiper("."+t.swipeid,{loop:t.loop,pagination:".swiper-pagination",paginationType:t.paginationType,autoplay:t.autoplay,direction:t.direction,effect:t.effect,autoplayDisableOnInteraction:!1,observer:!0,observeParents:!0,height:window.innerHeight,lazyLoading:!0,onTransitionStart:function(o){t.$emit("slideindex",o.activeIndex)}})},components:{}});var app=new Vue({data:{time_content:{day:"00",hour:"00",min:"00",sec:"00"},_sec:0,product:config.product,chat_list:config.chatList,ranks_list:[],pro_list:[],loading:!1,refreshing:!1,currentPrice:config.product.bidPrice,showAlert:!1,msg:null,open:!1,docked:!1,chosen:!1,swiper:"",tops:config.product.images,onId:0,addpri:"",wsurl:config.ws_auction_url+"?token="+config.product.token+"&relation_id="+config.product.id,ws:{},wsMsg:""},watch:{chat_list:function(t,o){this.$nextTick(function(){var t=this.$el.querySelector("#chatContainer");console.log(t),t.scrollTop=t.scrollHeight})}},mounted:function(){var t=this,o=this.$refs.swiper;o.dom&&(this.swiper=o.dom);var e=document.querySelector("#chatContainer"),i=new Hammer(e);i.on("swipeleft",function(t){console.log("swipeleft")}),i.on("swiperight",function(o){t.choose()}),t.choose(),t.product.status&&1===parseInt(t.product.status)&&t.choose(),t.init_ws()},methods:{initTime:function(){var t=this,o=t.product,e=0;1===o.status?e=parseInt((o.startTime-o.nowTime)/1e3):4!==o.status&&(e=parseInt((o.endTime-o.nowTime)/1e3)),t._sec=e},countdowm:function(t){var o=this,e=(new Date).getTime(),i=setInterval(function(){var n=new Date,a=new Date(1e3*t+e),r=a.getTime()-n.getTime();if(r>0){var s=Math.floor(r/864e5),c=Math.floor(r/36e5%24),d=Math.floor(r/6e4%60),u=Math.floor(r/1e3%60);c+=24*s,c=c<10?"0"+c:c,d=d<10?"0"+d:d,u=u<10?"0"+u:u,s>0&&(o.time_content.hour=c,o.time_content.min=d,o.time_content.sec=u),s<=0&&c>0&&(o.time_content.hour=c,o.time_content.min=d,o.time_content.sec=u),s<=0&&c<=0&&(o.time_content.min=d,o.time_content.sec=u)}else clearInterval(i),o.end()},1e3)},top:function(){tools.animate(document,{scrollTop:"0"},400,"ease-out")},choose:function(){var t=this;t.open?(t.open=!1,setTimeout(function(){t.docked=!1},300)):(t.docked=!0,t.open=!0)},add:function(){var t=this,o=t.product,e=parseFloat(t.addpri)||0,i=parseFloat(t.currentPrice);3===o.status&&(e<i?e=i+o.increasePrice:e+=o.increasePrice,t.addpri=e)},end:function(){4!==this.product.status&&tools.ajaxGet(config.reload_url,this.reloadData_suc,this.reloadData_bef)},reloadData_bef:function(){},reloadData_suc:function(t){var o=this;o.product=t.data,o.init_ws()},succhandle:function(t){var o=this;o.msg=t.message,o.showAlert=!0,t.url?o.close_auto(o.linkto,t.url):o.close_auto()},close:function(){this.showAlert=!1},close_auto:function(t,o){var e=this;setTimeout(function(){e.showAlert=!1,t&&t(o)},1500)},linkto:function(t){t&&(location.href=t)},init_ws:function(){var t=this;t.isEmpty(t.product);if(4!==t.product.status){var o=new WebSocket(t.wsurl);o.addEventListener("open",function(t){}),o.addEventListener("message",function(o){t.listenSocket(o)}),t.ws=o}t.setBidOn(t.chat_list);var e=t.$el.querySelector("#chatContainer");console.log(e),e.scrollTop=e.scrollHeight,t.initTime(),t.countdowm(this._sec)},listenSocket:function(t){var o=this;if(!o.isEmpty(t.data)){var e=JSON.parse(t.data);if(401===e.code&&(location.href=config.loginUrl),200!==e.code)return o.msg=e.msg,o.showAlert=!0,void o.close_auto();var i=o.product;1===e.data.roleType&&(e.data.bidStatus=1,i.bidCount=i.bidCount+1);var n=o.chat_list;if(n.push(e.data),console.log(n),o.chat_list=[],o.chat_list=n,console.log(o.chat_list),o.product={},o.product=i,1===e.data.roleType){var a=o.product;o.product={},a.product.bidUserHeadPortrait=e.data.headPortrait,a.product.bidUserName=e.data.userName,a.product.bidStatusName=e.data.bidStatusName?e.data.bidStatusName:"领先",a.product.bidPrice=e.data.bidPrice,o.currentPrice=e.data.bidPrice,o.product=a,o.setBidOn(o.chat_list)}}},setBidOn:function(t){var o=this,e=o.onId;if(e>0)e=t[t.length-1].id;else for(var i in t)if(t[i].bidStatus>0){e=t[i].id;break}o.onId=e},isEmpty:function(t){if(null===t||""===t||void 0===t||!1===t)return!0;if("object"==(void 0===t?"undefined":_typeof(t))){for(var o in t)return!1;return!0}return!1},bindDepositTap:function(){var t=this,o=this.product,e={goods_id:o.id};2===o.status?t.$refs.deppost.post(config.auction_signup_url,e):1===o.status?(t.msg="拍卖还未开始",t.showAlert=!0,t.close_auto()):4!==o.status?(t.msg="您已报过名了",t.showAlert=!0,t.close_auto()):4===o.status&&(t.msg="拍卖已经结束了",t.showAlert=!0,t.close_auto())},postSuc:function(t,o){},postTip:function(t){var o=this;o.msg=t.message,o.showAlert=!0,o.close_auto()},postBefore:function(){},postError:function(){},bindSubmitTap:function(){var t=this,o={goods_id:t.product.id,price:t.addpri};if(t.addpri<=0)return void console.log("出价不能小于当前最高价！");t.$refs.subpost.post(config.auction_bid_url,o)},bindSendTap:function(){var t=this;t.product.token&&""!==t.product.token&&null!==t.product.token?(t.ws.send(t.wsMsg),t.wsMsg=""):location.href=config.loginUrl},clear:function(){this.addpri=""}},components:{}}).$mount("#auctiondetail");